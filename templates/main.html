<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Video Upload Form</title>
    <style>
        body { font-family: Arial; background: #f4f4f4; padding: 40px; }
        .container { background: #fff; padding: 20px; max-width: 400px; margin: auto; border-radius: 6px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
        label { display: block; margin-top: 15px; font-weight: bold; }
        input, button { width: 100%; margin-top: 8px; padding: 8px; box-sizing: border-box; }
        button { background: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background: #0056b3; }
        #uploadStatus a { color: #007bff; text-decoration: none; }
        #uploadStatus a:hover { text-decoration: underline; }
        #progressBarContainer { width: 100%; background: #eee; border-radius: 4px; margin-top: 10px; display: none; }
        #progressBar { width: 0%; height: 8px; background: #007bff; border-radius: 4px; }
    </style>
</head>
<body>

<div class="container">
    <h2>Upload Video</h2>
    <form id="uploadForm" enctype="multipart/form-data">
        <label for="name">Name</label>
        <input type="text" id="name" name="name" required>

        <label for="phone">Phone Number</label>
        <input type="tel" id="phone" name="phone" required>

        <label for="video">Upload Video (Max 15 MB)</label>
        <input type="file" id="video" name="video" accept="video/*" required>

        <button type="submit">Submit</button>
    </form>

    <div id="progressBarContainer">
        <div id="progressBar"></div>
    </div>

    <div id="uploadStatus" style="margin-top:10px;"></div>
</div>

<script>
const MAX_FILE_SIZE = 15 * 1024 * 1024; // 15 MB

document.getElementById("uploadForm").addEventListener("submit", async function(event) {
    event.preventDefault();

    const statusDiv = document.getElementById("uploadStatus");
    const fileInput = document.getElementById("video");
    const file = fileInput.files[0];

    if (!file) {
        statusDiv.innerText = "Please select a video file.";
        return;
    }

    if (file.size > MAX_FILE_SIZE) {
        statusDiv.innerText = "File too large. Maximum allowed is 15 MB.";
        return;
    }

    statusDiv.innerText = "Uploading and transcribing...";
    const progressBarContainer = document.getElementById("progressBarContainer");
    const progressBar = document.getElementById("progressBar");
    progressBarContainer.style.display = "block";
    progressBar.style.width = "0%";

    const formData = new FormData(this);

    try {
        const xhr = new XMLHttpRequest();
        xhr.open("POST", "/upload");

        xhr.upload.onprogress = function(event) {
            if (event.lengthComputable) {
                const percent = (event.loaded / event.total) * 100;
                progressBar.style.width = percent + "%";
            }
        };

        xhr.onload = function() {
            progressBar.style.width = "100%";
            if (xhr.status >= 200 && xhr.status < 300) {
                const data = JSON.parse(xhr.responseText);
                statusDiv.innerHTML = `
                    âœ… ${data.message}<br>
                    Transcript ID: <b>${data.transcript_id}</b><br>
                    Frames extracted: ${data.frame_count}
                `;
                document.getElementById("uploadForm").reset();
            } else {
                console.error(xhr.responseText);
                statusDiv.innerText = "Upload or transcription failed. Check console.";
            }
        };

        xhr.onerror = function() {
            statusDiv.innerText = "Upload failed due to network error.";
        };

        xhr.send(formData);

    } catch (err) {
        console.error(err);
        statusDiv.innerText = "Unexpected error. Check console.";
    }
});
</script>

</body>
</html>
